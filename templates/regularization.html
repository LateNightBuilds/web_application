<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Regularization Impact</title>
    <style>
        .cool-nav {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .nav-icon {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: #5ac8fa;
            font-family: 'Fira Code', monospace;
            font-size: 20px;
            transition: all 0.3s;
        }

        .icon-container {
            position: relative;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }

        .icon-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: rgba(90, 200, 250, 0.1);
            transform: scale(0.8);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .home-icon {
            width: 30px;
            height: 30px;
            fill: none;
            stroke: #5ac8fa;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            z-index: 1;
            transition: all 0.3s;
        }

        .nav-text {
            opacity: 0;
            transform: translateX(-10px);
            transition: all 0.3s;
        }

        /* Hover effects */
        .nav-icon:hover .icon-circle {
            transform: scale(1);
            background-color: rgba(90, 200, 250, 0.2);
            box-shadow: 0 0 15px rgba(90, 200, 250, 0.5);
        }

        .nav-icon:hover .home-icon {
            transform: scale(1.1);
            stroke-width: 2.2;
        }

        .nav-icon:hover .nav-text {
            opacity: 1;
            transform: translateX(0);
        }

        /* Active state */
        .nav-icon:active .icon-circle {
            transform: scale(0.9);
            background-color: rgba(90, 200, 250, 0.3);
        }

        body {
            margin: 0;
            font-family: 'Fira Code', monospace;
            background-color: #121212;
            color: #e0e0e0;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 20px 40px;
        }

        .header-section {
            text-align: center;
            margin-bottom: 40px;
        }

        .header-section h1 {
            font-size: 36px;
            color: #5ac8fa;
            margin-bottom: 10px;
        }

        .header-section p {
            font-size: 16px;
            color: #bbb;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Three column layout */
        .content-wrapper {
            display: grid;
            grid-template-columns: 300px 1fr 250px;
            gap: 20px;
            margin-bottom: 40px;
        }

        @media (max-width: 1000px) {
            .content-wrapper {
                grid-template-columns: 1fr;
            }
        }

        /* Left column - Dataset */
        .dataset-panel {
            background-color: #1e1e1e;
            border-radius: 12px;
            padding: 20px;
            height: fit-content;
        }

        .panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .panel-title {
            font-size: 18px;
            color: #5ac8fa;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-indicator {
            background-color: #5ac8fa;
            color: #121212;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .dataset-options {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }

        .dataset-btn {
            padding: 12px;
            background-color: #2c2c2e;
            border: 2px solid transparent;
            border-radius: 8px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dataset-btn:hover {
            background-color: #3a3a3c;
            border-color: #5ac8fa;
        }

        .dataset-btn.active {
            background-color: #2c5f7c;
            border-color: #5ac8fa;
        }

        .dataset-icon {
            width: 40px;
            height: 40px;
            background-color: #1e1e1e;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dataset-info {
            flex: 1;
        }

        .dataset-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .dataset-desc {
            font-size: 11px;
            color: #888;
        }

        /* Center - Visualization */
        .visualization-panel {
            background-color: #1e1e1e;
            border-radius: 12px;
            padding: 20px;
            position: relative;
        }

        .visualization-box {
            position: relative;
            width: 100%;
            height: 500px;
            background-color: #2c2c2e;
            border-radius: 8px;
            overflow: hidden;
            cursor: crosshair;
            margin-top: 20px;
        }

        .scatter-plot {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }

        .decision-boundary {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }

        .dot {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 3;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .dot.class-0 {
            background-color: #5ac8fa;
        }

        .dot.class-1 {
            background-color: #ff3b30;
        }

        /* Right column - Controls */
        .controls-panel {
            background-color: #1e1e1e;
            border-radius: 12px;
            padding: 20px;
            height: fit-content;
        }

        .main-control {
            margin-bottom: 25px;
        }

        .slider-wrapper {
            background-color: #2c2c2e;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .slider-label {
            font-size: 14px;
            color: #bbb;
        }

        .slider-value {
            font-size: 18px;
            color: #5ac8fa;
            font-weight: bold;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: #3a3a3c;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            border-radius: 3px;
            margin: 10px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #5ac8fa;
            cursor: pointer;
            border-radius: 50%;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #5ac8fa;
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }

        .preset-buttons {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .preset-btn {
            flex: 1;
            padding: 6px;
            font-size: 11px;
            background-color: #3a3a3c;
            border: none;
            border-radius: 4px;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            background-color: #5ac8fa;
            color: #121212;
        }

        .run-button {
            width: 100%;
            padding: 14px;
            background-color: #5ac8fa;
            color: #121212;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 20px;
        }

        .run-button:hover {
            background-color: #48a4d9;
        }

        .run-button:disabled {
            background-color: #3a3a3c;
            color: #666;
            cursor: not-allowed;
        }

        /* Metrics display */
        .metrics-panel {
            background-color: #1e1e1e;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        @media (max-width: 800px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .metric-card {
            background-color: #2c2c2e;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .metric-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #5ac8fa;
        }

        /* Interactive hints */
        .hint-bubble {
            position: absolute;
            background-color: #2c5f7c;
            color: #e0e0e0;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 13px;
            z-index: 100;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s;
            pointer-events: none;
            max-width: 250px;
        }

        .hint-bubble.show {
            opacity: 1;
            transform: translateY(0);
        }

        .hint-bubble::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid #2c5f7c;
        }

        /* Advanced controls */
        .advanced-controls {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        .toggle-advanced {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 10px;
            background-color: #2c2c2e;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .toggle-advanced:hover {
            background-color: #3a3a3c;
        }

        .advanced-content {
            display: none;
        }

        .advanced-content.show {
            display: block;
        }

        /* Info box */
        .info-box {
            background-color: #2c5f7c;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-size: 14px;
            line-height: 1.6;
        }

        .info-box h4 {
            margin-top: 0;
            color: #5ac8fa;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
</head>
<body>
    <div class="cool-nav">
        <a href="/" class="nav-icon">
            <div class="icon-container">
                <div class="icon-circle"></div>
                <svg viewBox="0 0 24 24" class="home-icon">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
            </div>
            <span class="nav-text">Home</span>
        </a>
    </div>

    <div class="main-container">
        <div class="header-section">
            <h1>Understanding Regularization</h1>
            <p>See how regularization strength affects neural network decision boundaries in real-time</p>
        </div>

        <div class="metrics-panel">
            <h3 class="panel-title">Model Performance</h3>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Accuracy</div>
                    <div class="metric-value" id="accuracyValue">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Precision</div>
                    <div class="metric-value" id="precisionValue">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Recall</div>
                    <div class="metric-value" id="recallValue">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">F1 Score</div>
                    <div class="metric-value" id="f1Value">-</div>
                </div>
            </div>
        </div>

        <div class="content-wrapper">
            <!-- Left Panel - Dataset Selection -->
            <div class="dataset-panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <span class="step-indicator">1</span>
                        Choose Dataset
                    </h3>
                </div>

                <div class="dataset-options">
                    <button class="dataset-btn" id="moonsBtn" onclick="selectDataset('moons')">
                        <div class="dataset-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#5ac8fa" stroke-width="2">
                                <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.9 0 1.8-.1 2.6-.3-3.2-.9-5.6-3.8-5.6-7.2 0-4.1 3.4-7.5 7.5-7.5 1.3 0 2.5.3 3.5.9C18.1 4.5 15.3 2 12 2z"/>
                            </svg>
                        </div>
                        <div class="dataset-info">
                            <div class="dataset-name">Moons</div>
                            <div class="dataset-desc">Two interleaving crescents</div>
                        </div>
                    </button>

                    <button class="dataset-btn" id="circularBtn" onclick="selectDataset('circular')">
                        <div class="dataset-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#5ac8fa" stroke-width="2">
                                <circle cx="12" cy="12" r="3"/>
                                <circle cx="12" cy="12" r="9"/>
                            </svg>
                        </div>
                        <div class="dataset-info">
                            <div class="dataset-name">Circular</div>
                            <div class="dataset-desc">Inner circle vs outer ring</div>
                        </div>
                    </button>

                    <button class="dataset-btn" id="linearBtn" onclick="selectDataset('linear')">
                        <div class="dataset-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#5ac8fa" stroke-width="2">
                                <line x1="4" y1="20" x2="20" y2="4"/>
                                <circle cx="8" cy="8" r="2"/>
                                <circle cx="16" cy="16" r="2"/>
                            </svg>
                        </div>
                        <div class="dataset-info">
                            <div class="dataset-name">Linear</div>
                            <div class="dataset-desc">Linearly separable classes</div>
                        </div>
                    </button>

                    <button class="dataset-btn" id="customBtn" onclick="selectDataset('custom')">
                        <div class="dataset-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#5ac8fa" stroke-width="2">
                                <path d="M12 2v20M2 12h20"/>
                            </svg>
                        </div>
                        <div class="dataset-info">
                            <div class="dataset-name">Custom</div>
                            <div class="dataset-desc">Click to add your own points</div>
                        </div>
                    </button>
                </div>

                <div class="advanced-controls">
                    <div class="toggle-advanced" onclick="toggleAdvanced()">
                        <span>Advanced Settings</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                    <div class="advanced-content" id="advancedSettings">
                        <div class="control-group" style="margin-bottom: 15px;">
                            <label style="font-size: 13px; color: #bbb;">Number of Points</label>
                            <div class="slider-container" style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="numDataPoints" min="50" max="500" step="50" value="200" style="flex: 1;">
                                <span id="numDataPointsDisplay" style="min-width: 40px; text-align: right; font-size: 14px;">200</span>
                            </div>
                        </div>
                        <div class="control-group">
                            <label style="font-size: 13px; color: #bbb;">Noise Level</label>
                            <div class="slider-container" style="display: flex; align-items: center; gap: 10px;">
                                <input type="range" id="noiseLevel" min="0" max="0.2" step="0.01" value="0.05" style="flex: 1;">
                                <span id="noiseLevelDisplay" style="min-width: 40px; text-align: right; font-size: 14px;">0.05</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Panel - Visualization -->
            <div class="visualization-panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <span class="step-indicator">2</span>
                        Visualization
                    </h3>
                </div>

                <div class="info-box">
                    <h4>What am I looking at?</h4>
                    <p>• <span style="color: #5ac8fa;">Blue dots</span> and <span style="color: #ff3b30;">red dots</span> represent two different classes</p>
                    <p>• The colored background shows the model's decision boundary</p>
                    <p>• Adjust regularization to see how the boundary changes</p>
                </div>

                <div class="visualization-box" id="visualizationBox">
                    <div class="decision-boundary" id="decisionBoundary"></div>
                    <div class="scatter-plot" id="scatterPlot"></div>
                    <div class="hint-bubble" id="vizHint">Click anywhere to add custom data points</div>
                </div>
            </div>

            <!-- Right Panel - Controls -->
            <div class="controls-panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <span class="step-indicator">3</span>
                        Adjust & Run
                    </h3>
                </div>

                <div class="main-control">
                    <div class="slider-wrapper">
                        <div class="slider-header">
                            <span class="slider-label">Regularization (λ)</span>
                            <span class="slider-value" id="regularizationValDisplay">1.00</span>
                        </div>
                        <input type="range" id="regularizationVal" min="0.001" max="10" step="0.001" value="1.0" style="background: linear-gradient(to right, #ff3b30 0%, #ff9f0a 50%, #4cd964 100%);">
                        <div class="preset-buttons">
                            <button class="preset-btn" onclick="setRegularization(0.001)">Very Low</button>
                            <button class="preset-btn" onclick="setRegularization(0.1)">Low</button>
                            <button class="preset-btn" onclick="setRegularization(1.0)">Medium</button>
                            <button class="preset-btn" onclick="setRegularization(10)">High</button>
                        </div>
                    </div>

                    <div style="font-size: 12px; color: #888; margin-top: 10px; line-height: 1.5;">
                        <p style="margin: 5px 0;"><strong>Low λ:</strong> Complex boundary, may overfit</p>
                        <p style="margin: 5px 0;"><strong>High λ:</strong> Simple boundary, may underfit</p>
                    </div>
                </div>

                <button id="runModelBtn" class="run-button">Run Model</button>

                <div id="statusMessage" style="margin-top: 15px; font-size: 13px; text-align: center; color: #888;">
                    Select a dataset to begin
                </div>
            </div>
        </div>

        <div style="margin-top: 40px; background-color: #1e1e1e; border-radius: 12px; padding: 30px;">
            <h3 style="color: #5ac8fa; margin-bottom: 20px;">Understanding Regularization</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <h4 style="color: #ff3b30; font-size: 16px;">Low Regularization (λ ≈ 0)</h4>
                    <p style="font-size: 14px; color: #bbb; line-height: 1.6;">
                        The model has more freedom to fit the training data closely. This can lead to complex, wiggly decision boundaries that perfectly separate the training points but may not generalize well to new data.
                    </p>
                </div>
                <div>
                    <h4 style="color: #ff9f0a; font-size: 16px;">Medium Regularization (λ ≈ 1)</h4>
                    <p style="font-size: 14px; color: #bbb; line-height: 1.6;">
                        A balanced approach that prevents overfitting while still allowing the model to capture important patterns. The decision boundary is smoother but still follows the data structure.
                    </p>
                </div>
                <div>
                    <h4 style="color: #4cd964; font-size: 16px;">High Regularization (λ ≫ 1)</h4>
                    <p style="font-size: 14px; color: #bbb; line-height: 1.6;">
                        The model is strongly constrained, leading to very simple decision boundaries. While this prevents overfitting, it might miss important patterns in the data (underfitting).
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM elements
        const visualizationBox = document.getElementById('visualizationBox');
        const scatterPlot = document.getElementById('scatterPlot');
        const decisionBoundary = document.getElementById('decisionBoundary');
        const regularizationSlider = document.getElementById('regularizationVal');
        const regularizationDisplay = document.getElementById('regularizationValDisplay');
        const numDataPointsSlider = document.getElementById('numDataPoints');
        const numDataPointsDisplay = document.getElementById('numDataPointsDisplay');
        const noiseLevelSlider = document.getElementById('noiseLevel');
        const noiseLevelDisplay = document.getElementById('noiseLevelDisplay');
        const runModelBtn = document.getElementById('runModelBtn');
        const statusMessage = document.getElementById('statusMessage');
        const accuracyValue = document.getElementById('accuracyValue');
        const f1Value = document.getElementById('f1Value');
        const precisionValue = document.getElementById('precisionValue');
        const recallValue = document.getElementById('recallValue');
        const vizHint = document.getElementById('vizHint');

        // Data storage
        let dataPoints = [];
        let classLabels = [];
        let currentDataset = null;
        let isFirstRun = true;

        // Initialize
        function init() {
            // Set up sliders
            regularizationSlider.addEventListener('input', function() {
                regularizationDisplay.textContent = parseFloat(this.value).toFixed(3);
            });

            numDataPointsSlider.addEventListener('input', function() {
                numDataPointsDisplay.textContent = this.value;
            });

            noiseLevelSlider.addEventListener('input', function() {
                noiseLevelDisplay.textContent = parseFloat(this.value).toFixed(2);
            });

            // Set up run button
            runModelBtn.addEventListener('click', runModel);

            // Set up visualization click handler
            visualizationBox.addEventListener('click', function(e) {
                if (currentDataset === 'custom' && (e.target === visualizationBox || e.target === scatterPlot || e.target === decisionBoundary)) {
                    addDataPoint(e);
                }
            });

            // Show hint on hover for custom dataset
            visualizationBox.addEventListener('mouseenter', function() {
                if (currentDataset === 'custom' && dataPoints.length < 10) {
                    vizHint.classList.add('show');
                }
            });

            visualizationBox.addEventListener('mouseleave', function() {
                vizHint.classList.remove('show');
            });

            // Load default dataset
            setTimeout(() => {
                selectDataset('moons');
            }, 500);
        }

        // Dataset selection
        function selectDataset(dataset) {
            // Update UI
            document.querySelectorAll('.dataset-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(dataset + 'Btn').classList.add('active');

            currentDataset = dataset;
            clearData();

            if (dataset === 'custom') {
                statusMessage.textContent = 'Click on the visualization to add points. Shift+click for red class.';
                statusMessage.style.color = '#ff9f0a';
                vizHint.textContent = 'Click to add blue points, Shift+click for red points';
            } else {
                statusMessage.textContent = 'Generating dataset...';
                statusMessage.style.color = '#ff9f0a';

                setTimeout(() => {
                    switch(dataset) {
                        case 'moons':
                            generateMoonsData();
                            break;
                        case 'circular':
                            generateCircularData();
                            break;
                        case 'linear':
                            generateLinearData();
                            break;
                    }

                    // Auto-run on first dataset or if switching datasets
                    if (isFirstRun || dataPoints.length > 0) {
                        setTimeout(() => {
                            runModel();
                            isFirstRun = false;
                        }, 300);
                    }
                }, 100);
            }
        }

        // Set regularization value
        function setRegularization(value) {
            regularizationSlider.value = value;
            regularizationDisplay.textContent = value.toFixed(3);

            // Auto-run if we have data
            if (dataPoints.length > 0) {
                runModel();
            }
        }

        // Toggle advanced settings
        function toggleAdvanced() {
            const advancedContent = document.getElementById('advancedSettings');
            advancedContent.classList.toggle('show');
        }

        // Generate datasets
        function generateMoonsData() {
            clearData();

            const numPoints = parseInt(numDataPointsSlider.value);
            const noiseLevel = parseFloat(noiseLevelSlider.value);
            const pointsPerClass = Math.floor(numPoints / 2);

            // Center coordinates for the two half circles
            const center1X = 0.35;
            const center1Y = 0.5;
            const center2X = 0.65;
            const center2Y = 0.5;
            const radius = 0.3;

            // Class 0 - bottom half circle
            for (let i = 0; i < pointsPerClass; i++) {
                const angle = Math.PI + Math.random() * Math.PI;
                const r = radius * (0.8 + Math.random() * 0.4);
                const x = center1X + r * Math.cos(angle);
                const y = center1Y + r * Math.sin(angle);

                const noiseX = (Math.random() - 0.5) * noiseLevel;
                const noiseY = (Math.random() - 0.5) * noiseLevel;

                addPointToVisualization(
                    Math.max(0, Math.min(1, x + noiseX)),
                    Math.max(0, Math.min(1, y + noiseY)),
                    0
                );
            }

            // Class 1 - top half circle
            for (let i = 0; i < pointsPerClass; i++) {
                const angle = Math.random() * Math.PI;
                const r = radius * (0.8 + Math.random() * 0.4);
                const x = center2X + r * Math.cos(angle);
                const y = center2Y + r * Math.sin(angle);

                const noiseX = (Math.random() - 0.5) * noiseLevel;
                const noiseY = (Math.random() - 0.5) * noiseLevel;

                addPointToVisualization(
                    Math.max(0, Math.min(1, x + noiseX)),
                    Math.max(0, Math.min(1, y + noiseY)),
                    1
                );
            }

            statusMessage.textContent = 'Dataset ready. Adjust regularization and click "Run Model"';
            statusMessage.style.color = '#4cd964';
        }

        function generateCircularData() {
            clearData();

            const numPoints = parseInt(numDataPointsSlider.value);
            const noiseLevel = parseFloat(noiseLevelSlider.value);
            const innerPoints = Math.floor(numPoints * 0.4);
            const outerPoints = numPoints - innerPoints;

            const centerX = 0.5;
            const centerY = 0.5;

            // Class 0 - inner circle
            for (let i = 0; i < innerPoints; i++) {
                const angle = Math.random() * 2 * Math.PI;
                const radius = Math.random() * 0.2;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);

                const noiseX = (Math.random() - 0.5) * noiseLevel;
                const noiseY = (Math.random() - 0.5) * noiseLevel;

                addPointToVisualization(
                    Math.max(0, Math.min(1, x + noiseX)),
                    Math.max(0, Math.min(1, y + noiseY)),
                    0
                );
            }

            // Class 1 - outer ring
            for (let i = 0; i < outerPoints; i++) {
                const angle = Math.random() * 2 * Math.PI;
                const radius = 0.3 + Math.random() * 0.15;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);

                const noiseX = (Math.random() - 0.5) * noiseLevel;
                const noiseY = (Math.random() - 0.5) * noiseLevel;

                addPointToVisualization(
                    Math.max(0, Math.min(1, x + noiseX)),
                    Math.max(0, Math.min(1, y + noiseY)),
                    1
                );
            }

            statusMessage.textContent = 'Dataset ready. Adjust regularization and click "Run Model"';
            statusMessage.style.color = '#4cd964';
        }

        function generateLinearData() {
            clearData();

            const numPoints = parseInt(numDataPointsSlider.value);
            const noiseLevel = parseFloat(noiseLevelSlider.value);
            const pointsPerClass = Math.floor(numPoints / 2);

            // Generate linearly separable data
            for (let i = 0; i < pointsPerClass; i++) {
                const x = Math.random();
                const y = Math.random();

                // Class 0 - below diagonal
                if (y < x - 0.1) {
                    const noiseX = (Math.random() - 0.5) * noiseLevel;
                    const noiseY = (Math.random() - 0.5) * noiseLevel;

                    addPointToVisualization(
                        Math.max(0, Math.min(1, x + noiseX)),
                        Math.max(0, Math.min(1, y + noiseY)),
                        0
                    );
                } else {
                    i--; // Retry
                }
            }

            // Class 1 - above diagonal
            for (let i = 0; i < pointsPerClass; i++) {
                const x = Math.random();
                const y = Math.random();

                if (y > x + 0.1) {
                    const noiseX = (Math.random() - 0.5) * noiseLevel;
                    const noiseY = (Math.random() - 0.5) * noiseLevel;

                    addPointToVisualization(
                        Math.max(0, Math.min(1, x + noiseX)),
                        Math.max(0, Math.min(1, y + noiseY)),
                        1
                    );
                } else {
                    i--; // Retry
                }
            }

            statusMessage.textContent = 'Dataset ready. Adjust regularization and click "Run Model"';
            statusMessage.style.color = '#4cd964';
        }

        // Add data point
        function addDataPoint(event) {
            const rect = visualizationBox.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            const normalizedX = x / rect.width;
            const normalizedY = y / rect.height;

            const pointClass = event.shiftKey ? 1 : 0;

            dataPoints.push([normalizedX, normalizedY]);
            classLabels.push(pointClass);

            const dot = document.createElement('div');
            dot.className = `dot class-${pointClass}`;
            dot.style.left = `${x}px`;
            dot.style.top = `${y}px`;
            scatterPlot.appendChild(dot);

            updateRunButtonState();
        }

        // Add point to visualization (helper function)
        function addPointToVisualization(normalizedX, normalizedY, pointClass) {
            dataPoints.push([normalizedX, normalizedY]);
            classLabels.push(pointClass);

            const boxWidth = visualizationBox.offsetWidth;
            const boxHeight = visualizationBox.offsetHeight;
            const pixelX = normalizedX * boxWidth;
            const pixelY = normalizedY * boxHeight;

            const dot = document.createElement('div');
            dot.className = `dot class-${pointClass}`;
            dot.style.left = `${pixelX}px`;
            dot.style.top = `${pixelY}px`;
            scatterPlot.appendChild(dot);

            updateRunButtonState();
        }

        // Update run button state
        function updateRunButtonState() {
            const hasEnoughPoints = dataPoints.length >= 2;
            const hasClass0 = classLabels.includes(0);
            const hasClass1 = classLabels.includes(1);

            runModelBtn.disabled = !(hasEnoughPoints && hasClass0 && hasClass1);
        }

        // Clear data
        function clearData() {
            dataPoints = [];
            classLabels = [];

            while (scatterPlot.firstChild) {
                scatterPlot.removeChild(scatterPlot.firstChild);
            }

            decisionBoundary.style.backgroundImage = 'none';

            accuracyValue.textContent = '-';
            f1Value.textContent = '-';
            precisionValue.textContent = '-';
            recallValue.textContent = '-';

            runModelBtn.disabled = true;
        }

        // Run model
        async function runModel() {
            if (dataPoints.length < 2) {
                statusMessage.textContent = 'Need at least two data points to run a model.';
                statusMessage.style.color = '#ff3b30';
                return;
            }

            if (classLabels.indexOf(0) === -1 || classLabels.indexOf(1) === -1) {
                statusMessage.textContent = 'Need at least one point from each class.';
                statusMessage.style.color = '#ff3b30';
                return;
            }

            statusMessage.textContent = 'Training neural network...';
            statusMessage.style.color = '#ff9f0a';
            runModelBtn.disabled = true;

            try {
                const regularizationValue = parseFloat(regularizationSlider.value);

                const payload = {
                    regularization: regularizationValue,
                    data: dataPoints,
                    class: classLabels
                };

                const response = await fetch('/process_regularization', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Server responded with status: ${response.status}`);
                }

                const result = await response.json();

                if (result.boundary_image) {
                    const imgData = result.boundary_image;
                    decisionBoundary.style.backgroundImage = `url(data:image/png;base64,${imgData})`;
                    decisionBoundary.style.backgroundSize = 'cover';
                    decisionBoundary.style.backgroundPosition = 'center';
                    decisionBoundary.style.backgroundRepeat = 'no-repeat';
                }

                if (result.metrics) {
                    accuracyValue.textContent = (result.metrics.accuracy * 100).toFixed(1) + '%';
                    f1Value.textContent = result.metrics.f1.toFixed(3);
                    precisionValue.textContent = result.metrics.precision.toFixed(3);
                    recallValue.textContent = result.metrics.recall.toFixed(3);

                    // Color code accuracy
                    const accuracy = result.metrics.accuracy;
                    if (accuracy >= 0.9) {
                        accuracyValue.style.color = '#4cd964';
                    } else if (accuracy >= 0.7) {
                        accuracyValue.style.color = '#ff9f0a';
                    } else {
                        accuracyValue.style.color = '#ff3b30';
                    }
                }

                const regDescription = regularizationValue < 0.01 ? 'Very low λ: Complex boundary' :
                                     regularizationValue < 0.1 ? 'Low λ: Flexible boundary' :
                                     regularizationValue < 1 ? 'Medium λ: Balanced boundary' :
                                     regularizationValue < 5 ? 'High λ: Simple boundary' :
                                     'Very high λ: Very simple boundary';

                statusMessage.textContent = `Model trained! ${regDescription}`;
                statusMessage.style.color = '#4cd964';
            } catch (error) {
                console.error('Error running model:', error);
                statusMessage.textContent = `Error: ${error.message}`;
                statusMessage.style.color = '#ff3b30';
            } finally {
                runModelBtn.disabled = false;
                updateRunButtonState();
            }
        }

        // Start when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>